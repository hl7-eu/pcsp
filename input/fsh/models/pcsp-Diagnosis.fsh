// -------------------------------------------------------------------------------				
//  Logical Model				pcsp-Diagnosis.fsh
// -------------------------------------------------------------------------------				
Logical: Diagnosis				
Id: Diagnosis				
Title: "Diagnosis"				
Description:  """Diagnosis
Maturity Level: 2 - Ready for Review"""				
* identifier 1..* Identifier "ID" """diagnosis identifier"""				
* dateOfDiagnosis 0..* BackboneElement "Date of diagnosis" """Official date of diagnosis. Please report the date as documented in the clinical record. Differences across institutions may occur in defining this date (either the date of the final test (laboratory, imaging, surgery or pathology report) based on which therapeutic decision was taken. In other cases the date of the pathology report is used to define the date of diagnosis. The system will send an 'error' message if the date of diagnosis is more recent hat the date of start of treatment. If the date is unkown or partially missed insert the year at the best of your knowledge."""				
* centerOfDiagnosis 0..* BackboneElement "Center of diagnosis" """Institution in which the diagnosis was made."""				
* centerOfDiagnosis.identifier 0..1 Identifier "Center code" """Code of the institution in which the diagnosis was made.
IN AIEOP thus information is retrievable from the Mod.1.01 database"""				
* centerOfDiagnosis.name 0..1 string "Center name" """Center name"""				
* centerOfDiagnosis.city 0..1 string "Center city" """Center city"""				
* centerOfDiagnosis.country 1..1 string "Center country" """Center country"""				
* primaryTreatmentCenter 0..1 BackboneElement "Primary treatment center" """Report here the institution in which most of the treatment was given"""				
* primaryTreatmentCenter.name 0..1 string "Primary treatment center name" """Primary treatment center name"""				
* primaryTreatmentCenter.city 0..1 string "Primary treatment center city" """Primary treatment center city"""				
* primaryTreatmentCenter.country 0..1 string "Primary treatment center country" """Primary treatment center country"""				
* dateOfArrivalAtCenter 1..* dateTime "Date of arrival to our institution" """Date of arrival to our institution"""				
* diagnosticGroup 0..* CodeableConcept "Diagnostic Group" """Diagnostic Group. ICCC-3 Classification (Main and Extended classification tables)"""				
* morphologyCode 0..* CodeableConcept "Diagnosis" """Report the diagnosis using the ICD-O-3 Morphology coding system (an help tool is built into the system). If also the site of the tumor will be reported (see 'site') using the ICD-O-3 Topography codes, the system will automatically define the tumor according to ICCC-3 classic pediatric classification (see: Cancer category). This field is automatically generated if both ICD-O-3 Morphology and Topography data have been reported"""				
* tumorBehaviour 0..* CodeableConcept "Tumour behaviour (ICD-O-3 type)" """Tumour behaviour. Automatically generated by the system for benign tumors"""				
* description 0..1 string "Diagnosis description" """Diagnosis description"""				
* site 0..* BackboneElement "Site" """Site of the tumor"""				
* site.code 0..* CodeableConcept "Site(ICD-O-3 topography)" """Site . Report the site of the tumor using the ICD-O-3 Topography (an help tool is built into the system). If also ICD-O-3 Morphology data have been reported, the system will automatically define the tumor also according to ICCC-3 classic pediatric classification (see: Cancer category)"""				
* site.description 0..* string "Site description" """Site description . Free text to report the site of the tumor"""				
* laterality 0..* CodeableConcept "Laterality" """Laterality"""				
* metastasis 0..* BackboneElement "Metastatic" """Some tumors may be either localized (e.g. stage III neuroblastoma) or metastatic. Please specify."""				
* metastasis.identifier 0..* integer "Metastasis id" """Number of metastases"""				
* metastasis.site 0..* BackboneElement "Metastasis site" """Please report here the site(s) of metastases detected at diagnosis."""				
* metastasis.site.code 0..* CodeableConcept "Metastasis site code" """Metastases detected at diagnosis (using ICD-O-3 Topography). If site(s) is unknown, code C80.9"""				
* metastasis.site.description 0..* string "Additional description of sites of metastatis" """Additional description of sites of metastatis"""				
* geneticMarkers 0..1 string "Genetic markers(text)" """Please report here any genetic marker: chromosomal alterations (e.g. translocation, deletions, duplications); or other types of genetic alterations (amplification, deletion, mutation)"""				
* stage 0..1 string "Stage/Risk" """Stage/Risk. Free trext to specify the stage, if applicable, of the tumor at diagnosis. Staging codes may be different across tumor types and eras of treatment. Please report the one used to define the survivors' tumor at the moment of diagnosis.
In case of leukemia the 'risk' (e.g. high, standard) could be reported. If the stage is unknown, specifie 'NK'"""				
* immunology 0..* CodeableConcept "Immunology" """Immunology . This is a free text field. Report here, if applicable (e.g. leukemias) the immunophenotype of the disease (sometimes already reported in the ICD-O-3 Morphology coding). If immunology is unknown, specify 'NK'"""				
* hereditaryPredisposition 0..* CodeableConcept "Hereditary Cancer Predisposition" """Hereditary Cancer Predisposition Syndromeor medical condition cancer associated. Report here if the survivor has some Hereditary Cancer Predisposition Syndrome or a medical conditions, cancer associated. The SurPass system provides a list of the most common Hereditary Cancer Predisposition Syndromes or other medical conditions reported to be cancer associated (an help tool is build into the system: when you start writing the computer proposes the syndromes/conditions with similar spelling). If the syndrome is not listed, please mark other and then 'Specify'"""				
* notes 0..* string "Notes" """Notes"""				
//--- END				
//--- END				
//--- END				
//--- END				
				
				
// -------------------------------------------------------------------------------				
//  Map to FHIR R4				
// -------------------------------------------------------------------------------				
Mapping: Diagnosis2Fhir				
Id: fhir				
Title: "Diagnosis model to PCSP HL7 FHIR R4 Profiles"				
Source: Diagnosis				
Target: "hl7.org/fhir/r4"				
				
* . -> "Condition.conformsTo('http://hl7.eu/fhir/ig/pcsp/StructureDefinition/Condition-primaryCancer-eu-pcsp')"				
* identifier -> ".identifier"				
* dateOfDiagnosis -> ".extension('condition-assertedDate').valueDateTime"				
* centerOfDiagnosis -> "Observation.conformsTo('http://hl7.eu/fhir/ig/pcsp/StructureDefinition/Observation-diagnosis-eu-pcsp').performer"				
* centerOfDiagnosis.identifier -> "Observation.performer.resolve().identifier"				
* centerOfDiagnosis.identifier -> "Observation.performer.identifier"				
* centerOfDiagnosis.name -> "Observation.performer.resolve().name"				
* centerOfDiagnosis.name -> "Observation.performer.display"				
* centerOfDiagnosis.city -> "Observation.performer.resolve().address.city"				
* centerOfDiagnosis.country -> "Observation.performer.resolve().address.country"				
* primaryTreatmentCenter -> "Patient.generalPractitioner"				
* primaryTreatmentCenter -> "Encounter.serviceProvider"				
* primaryTreatmentCenter.name -> "Patient.generalPractitioner.display"				
* primaryTreatmentCenter.name -> "Patient.generalPractitioner.resolve().name"				
* primaryTreatmentCenter.name -> "Encounter.serviceProvider.display"				
* primaryTreatmentCenter.name -> "Encounter.serviceProvider.resolve().name"				
* primaryTreatmentCenter.city -> "Patient.generalPractitioner.resolve().address.city"				
* primaryTreatmentCenter.city -> "Encounter.serviceProvider.resolve().address.city"				
* primaryTreatmentCenter.country -> "Patient.generalPractitioner.resolve().address.country"				
* primaryTreatmentCenter.country -> "Encounter.serviceProvider.resolve().address.country"				
* dateOfArrivalAtCenter -> "Encounter.period.start"				
* diagnosticGroup -> "Condition.code.coding"				
* morphologyCode -> "Condition.extension('mcode-histology-morphology-behavior').valueCodeableConcept"				
* tumorBehaviour -> "Condition.extension('mcode-histology-morphology-behavior').valueCodeableConcept"				
* description -> "Condition.text"				
* description -> "Condition.code.text"				
* site -> "Condition.bodySite"				
* site.code -> "Condition.bodySite.coding"				
* site.description -> "Condition.bodySite.text"				
* laterality -> "Condition.bodySite.extension('mcode-laterality-qualifier').valueCodeableConcept"				
* metastasis -> "Condition.conformsTo('http://hl7.eu/fhir/ig/pcsp/StructureDefinition/Condition-secondaryCancer-eu-pcsp')"				
* metastasis.identifier -> ".identifier"				
* metastasis.site -> ".bodySite"				
* metastasis.site.code -> ".bodySite.coding"				
* metastasis.site.description -> ".bodySite.text"				
* geneticMarkers -> "Condition.evidence.where(code = http://snomed.info/sct#106221001 'Genetic finding')"				
* stage -> "Condition.stage"				
* immunology -> "Condition.evidence.where(code = http://snomed.info/sct#365861007 'Finding of immune status')"				
* hereditaryPredisposition -> "Condition.evidence.where(code = http://snomed.info/sct#32895009 'Hereditary disease')"				
* notes -> "Condition.note"				
// --END				
// --END				
// --END				
